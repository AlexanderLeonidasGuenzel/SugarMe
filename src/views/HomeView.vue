/* eslint-disable */

<script setup lang="ts">

/*
Energy Drink: 5060337500401
Gummib√§rchen: 4037400344980
 */

import {reactive, type Ref, ref} from "vue";
import {createProduct, receiveJsonByBarcode, receiveJsonByCategory} from "@/assets/js/foodapi/foodapi";
import { Product } from "@/assets/js/foodapi/product";
import YourProduct from "@/components/YourProduct.vue";
import ListItem from "@/components/ListItem.vue";
import Search from "@/components/Search.vue";
import Header from "@/components/Header.vue";
import Footer from "@/components/Footer.vue";

let loadData: Ref<Boolean> = ref(false);

let mainproduct: Product;
let productlist: Product[] = [];

async function loadProductData(barcode: string) {
  productlist = [];
  loadData.value = false;
  const barcodejson = await receiveJsonByBarcode(barcode);
  mainproduct = reactive(createProduct(barcodejson));
  const json = await receiveJsonByCategory(mainproduct.kategorie);
  for (let i = 0; i < json.products.length; i++) {
    productlist.push(reactive(createProduct(json.products[i])));
  }
  loadData.value = true;
}
</script>

<template>


  <div class="relative flex justify-center items-center w-full h-full bg-gradient-to-br from-cyan-200 to-purple-900">
    <!-- MAIN -->
    <div class="flex flex-col justify-between items-center w-[489px] min-w-[375px] max-w-[489px] h-screen bg-gray-100 px-10 pt-5">
      <Header />
      <Search @click:search="loadProductData"/>

      <YourProduct :mainproduct="mainproduct" :imageurl="mainproduct.product_image" v-if="loadData"/>

      <div class="flex justify-between w-full bg-white px-5 py-2 font-bold rounded-s mb-1" v-if="loadData">
        <p>Produkt</p>
        <p>Zucker pro 100g</p>
      </div>

      <div class="relative w-full h-3/5 my-5 overflow-y-auto" v-if="loadData">
        <div v-if="loadData">
          <div v-for="(item, index) in productlist" :key="index">
            <ListItem class="flex items-center w-full h-12 pr-1 hover:bg-gray-200 border-b border-cyan-700 cursor-pointer" :child="item" v-if="item.name !== undefined && item.name !== ''"></ListItem>
          </div>
        </div>
      </div>
    <Footer></Footer>
    </div>
  </div>
</template>
